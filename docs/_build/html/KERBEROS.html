

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Kerberos authentication &mdash; FogLAMP  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="FogLAMP  documentation" href="index.html"/>
        <link rel="next" title="Plugin Documentation" href="plugin_index.html"/>
        <link rel="prev" title="Downloads" href="92_downloads.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> FogLAMP
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_data.html">Processing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="foglamp_architecture.html">FogLAMP Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="foglamp_plugins.html">FogLAMP Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="securing_foglamp.html">Securing FogLAMP</a></li>
<li class="toctree-l1"><a class="reference internal" href="notifications.html">Notifications Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugin_developers_guide/index.html">Plugin Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="rest_api_guide/index.html">REST API Developers Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_index.html">Building FogLAMP</a></li>
<li class="toctree-l1"><a class="reference internal" href="91_version_history.html">Version History</a></li>
<li class="toctree-l1"><a class="reference internal" href="92_downloads.html">Downloads</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Kerberos authentication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pi-server-as-the-north-endpoint">PI-Server as the North endpoint</a></li>
<li class="toctree-l2"><a class="reference internal" href="#north-plugin">North plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="#foglamp-server-configuration">FogLAMP server configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ip-address-resolution-of-the-kdc">IP Address resolution of the KDC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kerberos-client-configuration">Kerberos client configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kerberos-keytab-file">Kerberos keytab file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting-the-kerberos-authentication">Troubleshooting the Kerberos authentication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#kerberos-authentication-on-redhat-centos">Kerberos authentication on RedHat/CentOS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plugin_index.html">Plugin Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">FogLAMP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Kerberos authentication</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/KERBEROS.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="kerberos-authentication">
<h1>Kerberos authentication<a class="headerlink" href="#kerberos-authentication" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The bundled OMF north plugin in FogLAMP can use a number of different authentication schemes when communicating with the various OSIsoft products. The PI Web API method in the <a class="reference external" href="https://omf-docs.osisoft.com/">OMF</a> plugin supports the use of a Kerberos scheme.</p>
<p>The FogLAMP <em>requirements.sh</em> script installs the Kerberos client to allow the integration with what in the specific terminology is called KDC (the Kerberos server).</p>
</div>
<div class="section" id="pi-server-as-the-north-endpoint">
<h2>PI-Server as the North endpoint<a class="headerlink" href="#pi-server-as-the-north-endpoint" title="Permalink to this headline">¶</a></h2>
<p>The OSI <em>Connector Relay</em> allows token authentication while <em>PI Web API</em> supports Basic and Kerberos.</p>
<p>There could be more than one configuration to allow the Kerberos authentication,
the easiest one is the Windows server on which the PI-Server is executed act as the Kerberos server also.</p>
<p>The Windows Active directory should be installed and properly configured for allowing the Windows server to authenticate Kerberos requests.</p>
</div>
<div class="section" id="north-plugin">
<h2>North plugin<a class="headerlink" href="#north-plugin" title="Permalink to this headline">¶</a></h2>
<p>The North plugin has a set of configurable options that should be changed, using either the FogLAMP API or the FogLAMP GUI,
to select the Kerberos authentication.</p>
<p>The North plugin supports the configurable option <em>PIServerEndpoint</em> for allowing to select the target among:</p>
<blockquote>
<div><ul class="simple">
<li>Connector Relay</li>
<li>PI Web API</li>
<li>Edge Data Store</li>
<li>OSIsoft Cloud Services</li>
</ul>
</div></blockquote>
<p>The <em>PIWebAPIAuthenticationMethod</em> option permits to select the desired authentication among:</p>
<blockquote>
<div><ul class="simple">
<li>anonymous</li>
<li>basic</li>
<li>kerberos</li>
</ul>
</div></blockquote>
<p>The Kerberos authentication requires a keytab file, the <em>PIWebAPIKerberosKeytabFileName</em> option specifies the name of the file expected under the directory:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span><span class="o">{</span>FOGLAMP_ROOT<span class="o">}</span>/data/etc/kerberos
</pre></div>
</div>
<p><strong>NOTE:</strong></p>
<ul class="simple">
<li><em>A keytab is a file containing pairs of Kerberos principals and encrypted keys (which are derived from the Kerberos password). A keytab file allows to authenticate to various remote systems using Kerberos without entering a password.</em></li>
</ul>
<p>the <em>AFHierarchy1Level</em> option allows to specific the first level of the hierarchy that will be created into the Asset Framework and will contain the information for the specific
North plugin.</p>
</div>
<div class="section" id="foglamp-server-configuration">
<h2>FogLAMP server configuration<a class="headerlink" href="#foglamp-server-configuration" title="Permalink to this headline">¶</a></h2>
<p>The server on which FogLAMP is going to be executed needs to be properly configured to allow the Kerberos authentication.</p>
<p>The following steps are needed:</p>
<blockquote>
<div><ul class="simple">
<li><em>IP Address resolution for the KDC</em></li>
<li><em>Kerberos client configuration</em></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><em>Kerberos keytab file setup</em></li>
</ul>
</div></blockquote>
</div></blockquote>
<div class="section" id="ip-address-resolution-of-the-kdc">
<h3>IP Address resolution of the KDC<a class="headerlink" href="#ip-address-resolution-of-the-kdc" title="Permalink to this headline">¶</a></h3>
<p>The Kerberos server name should be resolved to the corresponding IP Address, editing the <em>/etc/hosts</em> is one of the possible and the easiest way, sample row to add:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">192.168.1.51    pi-server.dianomic.com pi-server</span>
</pre></div>
</div>
<p>try the resolution of the name using the usual <em>ping</em> command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ping -c <span class="m">1</span> pi-server.dianomic.com

<span class="go">PING pi-server.dianomic.com (192.168.1.51) 56(84) bytes of data.</span>
<span class="go">64 bytes from pi-server.dianomic.com (192.168.1.51): icmp_seq=1 ttl=128 time=0.317 ms</span>
<span class="go">64 bytes from pi-server.dianomic.com (192.168.1.51): icmp_seq=2 ttl=128 time=0.360 ms</span>
<span class="go">64 bytes from pi-server.dianomic.com (192.168.1.51): icmp_seq=3 ttl=128 time=0.455 ms</span>
</pre></div>
</div>
<p><strong>NOTE:</strong></p>
<ul class="simple">
<li><em>the name of the KDC should be the first in the list of aliases</em></li>
</ul>
</div>
<div class="section" id="kerberos-client-configuration">
<h3>Kerberos client configuration<a class="headerlink" href="#kerberos-client-configuration" title="Permalink to this headline">¶</a></h3>
<p>The server on which FogLAMP runs act like a Kerberos client and the related configuration file should be edited for allowing the proper Kerberos server identification.
The information should be added into the <em>/etc/krb5.conf</em> file in the corresponding section, for example:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">[libdefaults]</span>
<span class="go">        default_realm = DIANOMIC.COM</span>

<span class="go">[realms]</span>
<span class="go">    DIANOMIC.COM = {</span>
<span class="go">        kdc = pi-server.dianomic.com</span>
<span class="go">        admin_server = pi-server.dianomic.com</span>
<span class="go">    }</span>
</pre></div>
</div>
</div>
<div class="section" id="kerberos-keytab-file">
<h3>Kerberos keytab file<a class="headerlink" href="#kerberos-keytab-file" title="Permalink to this headline">¶</a></h3>
<p>The keytab file should be generated on the Kerberos server and copied into the FogLAMP server in the directory:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span><span class="o">{</span>FOGLAMP_DATA<span class="o">}</span>/etc/kerberos
</pre></div>
</div>
<p><strong>NOTE:</strong></p>
<ul class="simple">
<li>if <strong>FOGLAMP_DATA</strong> is not set its value should be <em>$FOGLAMP_ROOT/data</em>.</li>
</ul>
<p>The name of the file should match the value of the North plugin option <em>PIWebAPIKerberosKeytabFileName</em>, by default <em>piwebapi_kerberos_https.keytab</em></p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ls -l <span class="si">${</span><span class="nv">FOGLAMP_DATA</span><span class="si">}</span>/etc/kerberos
<span class="go">-rwxrwxrwx 1 foglamp foglamp  91 Jul 17 09:07 piwebapi_kerberos_https.keytab</span>
<span class="go">-rw-rw-r-- 1 foglamp foglamp 199 Aug 13 15:30 README.rst</span>
</pre></div>
</div>
<p>The way the keytab file is generated depends on the type of the Kerberos server, in the case of Windows Active Directory this is an sample command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">ktpass -princ HTTPS/pi-server@DIANOMIC.COM -mapuser Administrator@DIANOMIC.COM -pass Password -crypto AES256-SHA1 -ptype KRB5_NT_PRINCIPAL -out C:\Temp\piwebapi_kerberos_https.keytab</span>
</pre></div>
</div>
</div>
<div class="section" id="troubleshooting-the-kerberos-authentication">
<h3>Troubleshooting the Kerberos authentication<a class="headerlink" href="#troubleshooting-the-kerberos-authentication" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>check the North plugin configuration, a sample command</li>
</ol>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">curl -s -S -X GET http://localhost:8081/foglamp/category/North_Readings_to_PI | jq &quot;.|{URL,&quot;PIServerEndpoint&quot;,PIWebAPIAuthenticationMethod,PIWebAPIKerberosKeytabFileName,AFHierarchy1Level}&quot;</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>check the presence of the keytab file</li>
</ol>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ls -l <span class="si">${</span><span class="nv">FOGLAMP_ROOT</span><span class="si">}</span>/data/etc/kerberos
<span class="go">-rwxrwxrwx 1 foglamp foglamp  91 Jul 17 09:07 piwebapi_kerberos_https.keytab</span>
<span class="go">-rw-rw-r-- 1 foglamp foglamp 199 Aug 13 15:30 README.rst</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>verify the reachability of the Kerberos server (usually the PI-Server) - Network reachability</li>
</ol>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ping pi-server.dianomic.com
<span class="go">PING pi-server.dianomic.com (192.168.1.51) 56(84) bytes of data.</span>
<span class="go">64 bytes from pi-server.dianomic.com (192.168.1.51): icmp_seq=1 ttl=128 time=5.07 ms</span>
<span class="go">64 bytes from pi-server.dianomic.com (192.168.1.51): icmp_seq=2 ttl=128 time=1.92 ms</span>
</pre></div>
</div>
<p>Kerberos reachability and keys retrival</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> kinit -p HTTPS/pi-server@DIANOMIC.COM
<span class="go">Password for HTTPS/pi-server@DIANOMIC.COM:</span>
<span class="gp">$</span> klist
<span class="go">Ticket cache: FILE:/tmp/krb5cc_1001</span>
<span class="go">Default principal: HTTPS/pi-server@DIANOMIC.COM</span>

<span class="go">Valid starting       Expires              Service principal</span>
<span class="go">09/27/2019 11:51:47  09/27/2019 21:51:47  krbtgt/DIANOMIC.COM@DIANOMIC.COM</span>
<span class="go">    renew until 09/28/2019 11:51:46</span>
<span class="gp">$</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="kerberos-authentication-on-redhat-centos">
<h2>Kerberos authentication on RedHat/CentOS<a class="headerlink" href="#kerberos-authentication-on-redhat-centos" title="Permalink to this headline">¶</a></h2>
<p>RedHat and CentOS version 7.6 provide by default an old version of curl and the related libcurl
and it does not support Kerberos, output of the curl provided by CentOS:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> curl -V
<span class="go">curl 7.29.0 (x86_64-redhat-linux-gnu) libcurl/7.29.0 NSS/3.36 zlib/1.2.7 libidn/1.28 libssh2/1.4.3</span>
<span class="go">Protocols: dict file ftp ftps gopher http https imap imaps ldap ldaps pop3 pop3s rtsp scp sftp smtp smtps telnet tftp</span>
<span class="go">Features: AsynchDNS GSS-Negotiate IDN IPv6 Largefile NTLM NTLM_WB SSL libz unix-sockets</span>
</pre></div>
</div>
<p>The <em>requirements.sh</em> evaluates if the default version 7.29.0 is installed and in this case it will download the sources, build and install
the version 7.65.3 to provide Kerberos authentication, output of the curl after the upgrade:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> curl -V
<span class="go">curl 7.65.3 (x86_64-unknown-linux-gnu) libcurl/7.65.3 OpenSSL/1.0.2k-fips zlib/1.2.7</span>
<span class="go">Release-Date: 2019-07-19</span>
<span class="go">Protocols: dict file ftp ftps gopher http https imap imaps pop3 pop3s rtsp smb smbs smtp smtps telnet tftp</span>
<span class="go">Features: AsynchDNS GSS-API HTTPS-proxy IPv6 Kerberos Largefile libz NTLM NTLM_WB SPNEGO SSL UnixSockets</span>
</pre></div>
</div>
<p>The sources are downloaded from the curl repository <a class="reference external" href="https://github.com/curl/curl/releases">curl sources</a>, the curl homepage is available at <a class="reference external" href="https://curl.haxx.se/">curl homepage</a>.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="plugin_index.html" class="btn btn-neutral float-right" title="Plugin Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="92_downloads.html" class="btn btn-neutral" title="Downloads" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Dianomic Systems.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>